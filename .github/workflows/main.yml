name: Deploy React App

on:
  push:
  


jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup SSH
      run: |
        mkdir -p ~/.ssh
        echo "${{ secrets.SSH_KEY }}" > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa
        ssh-keyscan -H ${{ secrets.HOST }} >> ~/.ssh/known_hosts

    - name: Deploy to EC2
      run: |
        ssh ${{ secrets.USERNAME }}@${{ secrets.HOST }} << EOF
          rm -rf ~/react-deploy || true
          git clone https://${{ secrets.GH_TOKEN }}@github.com/YOUR_USERNAME/YOUR_REPO.git ~/react-deploy
          cd ~/react-deploy

          docker stop react-app || true
          docker rm react-app || true

          docker build -t react-app .
          docker run -d -p 80:80 --name react-app react-app
        EOF
